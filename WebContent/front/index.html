<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	
		<link href="../css/bootstrap.css"  type="text/css" rel="stylesheet"/>
        <style type="text/css">
             body{
             	
             	background-color: #EEEEEE;
             }
        
        	#carousel-example-generic img{
        		margin: 0 auto;
        	}
        	
        	#carousel-example-generic{
        		
        		margin-top: 0px;
        	}
     
        </style>
	</head>
	<body>
		<!--导航条，在顶部固定-->
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
			 <!--导航条的头部-->
			 <div class="navbar-header">
			 	<a class="navbar-brand" >
			 		Logo
			 		
			 	</a>
			 	<!-- 缩小之后的按钮 -->
			 	 <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				      <span class="sr-only">Toggle navigation</span>
				      <span class="icon-bar"></span>
				      <span class="icon-bar"></span>
				      <span class="icon-bar"></span>
    			</button>
			 </div>
			
			
			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			  	<ul class="nav navbar-nav navbar-right">
			  		<li><a href="case.html" id="login"><span class="glyphicon glyphicon-fire"></span><span id="login_info">登录</span></a></li>
			  		<li><a href="case.html"><span class="glyphicon glyphicon-fire"></span>注册</a></li>
					<li><a href="shopping.html" class="logonConfirm"><span class="glyphicon glyphicon-home"></span>购物车 <span class="badge" >42</span></a></li>
					<li><a href="information.html"><span class="glyphicon glyphicon-list"></span>个人资料</a></li>
					 
	
				</ul>
			  </div>
			
		</nav>
		<!-- 搜索框 -->
	<div  style="background-color: orangered;margin-top: 50px;padding: 10px;">
			<div class="input-group" style="width: 60%;margin: 0px auto;">
				  <input type="text" class="form-control" placeholder="请输入商品名称" id="goods_name_txt">
				  <span class="input-group-addon" style="cursor: pointer" id="goods_search_btn">查询</span>
			</div>
	 
	</div>


    <!--轮播图-->
    <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
		  <!-- 轮播图上的序号 -->
		  <ol class="carousel-indicators">
		    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
		    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
		    <li data-target="#carousel-example-generic" data-slide-to="2"></li>
		  </ol>
		
		  <!-- 设置滑动的图片-->
		  <div class="carousel-inner">
		    <div class="item active">
		      <img src="img/slide1.png" alt="...">
		    </div>
		    
		    
		    
		     <div class="item">
		      <img src="img/slide2.png" alt="...">
		    </div>
		    
		    <div class="item">
		      <img src="img/slide3.png" alt="...">
		    </div>
		  </div>
		
		  <!-- 控制图片滑动额左右箭头 -->
		  <a class="left carousel-control" href="#carousel-example-generic" data-slide="prev">
		    <span class="glyphicon glyphicon-chevron-left"></span>
		  </a>
		  <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
		    <span class="glyphicon glyphicon-chevron-right"></span>
		  </a>
		</div>
          
          <!--使用bootstrap栅格系统-->
		  
		 <div class="container" style="margin-top: 10px;">
		  	 <div class="row" id="goods">
		  	 	
		  	    		  	 <div class="col-sm-6 col-md-4 col-xs-12 col-lg-3">
							    <div class="thumbnail">
							      <img src="..\front\img\slide1.png" style="width: 100%;height: 200px">
							     <div class="caption"> 
									<h4>笔记本</h4>
									<h5 style="color: red">价格：<span>4000</span></h5>
									<p>库存量:<span>10</span></p>
									
									<p>
										<button class="btn btn-danger">购买</button>
										&nbsp;&nbsp;&nbsp;&nbsp;
										<button class="btn btn-success">加入购物车</button>
									</p>
								 </div>
							    </div>
							  </div>
							
					 
		  	    
		  	    		
		  	            
  
							
		  	     
		 	</div>
		 	
		 				<ul class="pagination pull-right" id="pages">
						
						</ul>
		</div>
		

<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">登录</h4>
      </div>
      <div class="modal-body">
        				<form class="form-horizontal"  id="form-info" name="login_form"> 
							<div class="form-group">
								<label class="col-md-4 col-sm-4 control-label">用户名：</label>
								<div class="col-md-6 ">
									<input type="text" class="form-control"  required="required" name="cusName" value="<%=userName%>">
								
								</div>
							</div>
							<div class="form-group">
								<label class="col-md-4 col-sm-4 control-label">密码：</label>
								<div class="col-md-6 ">
									<input type="password" class="form-control"  required="required" name="cusPwd">
								
								</div>
							</div>
							<div class="form-group">
								<label class="col-md-4 col-sm-4 control-label"></label>
								<div class="col-md-6">
									
								   
								</div>
								<div class="col-md-2">
								 
								 </div>
							</div>
						
					
							
						</form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="submit" class="btn btn-primary" id="login_btn" form="login_form">登录</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


		<script src="../js/jquery-1.12.3.min.js" type="text/javascript"></script>
		<script src="../js/bootstrap.min.js" type="text/javascript"></script>
		<script type="text/javascript">
		//登陆成功不能再点击出登陆框
			$("#login").click(function(){
				if($("#login_info").html()=="登录"){
					$('#myModal').modal();
				}
				return false;
			});
		
			//登录验证
			$("#login_btn").click(function(){
				$.ajax({
					cache:false,
					url:"logon.do",
					type:"post",
					data:$("#form-info").serialize(),
					async:true,
					
					error:function(){
						alert("登录失败");
					},
					
					success:function(data){
						var customerName = $(":text[name=cusName]").val();
						//如果登陆成功将名字显示在登陆框
						if(data=="true"){
							$("#login_info").html(customerName+"已登录");
							//并关闭模态框
							$('#myModal').modal('hide');
						}else{
							alert("登录失败");
							
						}
					}
				});
				return false;
				
			});
			
			
			
			//调用加载数据的函数
			loadData(1,"");
			/*加载页面中药显示所有的数据*/
			function loadData(curentPage,goodsNameParam){
				
				$.ajax({
				    cache: false,
				    type: "POST",
				    url:"goodsAll.do",
				    data:{"currentPage":curentPage,"goodsName":goodsNameParam},
				    dataType:"json",
				    async: true,
				    error: function(request) {
				        alert("Connection error");
				    },
				    success: function(data) {
				    	//加载商品信息
				    	var goodsList=data.goodsJson.li;
				    	var str="";
				    	for(var i=0;i<goodsList.length;i++){
				    	
				    		str=str+"<div class=\"col-sm-6 col-md-4 col-xs-12 col-lg-3\">";
				    		str=str+"<div class= thumbnail >";
				    		//front\upload\202001071114097578.jpg
				    		str=str+"<img src= '../"+goodsList[i].goodsImg+"'  style=\"width: 100%;height: 200px\">";
				    		str=str+"<div class= caption>"; 
				    		str=str+"<h4>"+goodsList[i].goodsName+"</h4>";
				    		str=str+"<h5 style=\"color: red\">价格：<span>"+goodsList[i].goodsPrice+"</span></h5>";
				    		str=str+"<p>库存量:<span>"+goodsList[i].goodsCount+"</span></p>";
									
				    		str=str+"<p>";
				    		str=str+"<button class=\"btn btn-danger\">购买</button>";
				    		str=str+"&nbsp;&nbsp;&nbsp;&nbsp;";
				    		str=str+"<button class=\"btn btn-success\" name=\"add_shop_btn\"  title="+goodsList[i].goodsId+">加入购物车</button>";
				    		str=str+"</p>";
				    		str=str+"</div></div></div>";
				    		
				    	}
				    
				    	$("#goods").html(str);
				    	
				    
				    	//加载分页信息
				    	
				  	  var pageStr="<li><a href= "+(data.goodsJson.currentPage-1)+">&laquo;</a></li>";
				  	  
				  	  for(var i=1;i<=data.goodsJson.totalPages;i++){
				  		if(i==data.goodsJson.currentPage){  
				  		  pageStr=pageStr+"<li class= active><a href= "+i+">"+i+"</a></li>";
				  		}
				  		else{
				  		 pageStr=pageStr+"<li ><a href= "+i+">"+i+"</a></li>";
				  		}
				  		  
				  	  }
					
				
				  	  pageStr=pageStr+"<li><a href= "+(data.goodsJson.currentPage+1)+">&raquo;</a></li>";
				  	
					  $("#pages").html(pageStr);
					  //当前页添加点击事件
					  pageClick();
					  
					  var count=data.cusCount;
					  $(".badge").text(count);
					  //每次加载页面，判断用户是否已登录,session中获取用户名
				      var customerName=data.cusName;
					  checkLogon(customerName);
					  
					  //加入购物车按钮添加单击事件
					  clickShopping();
				    }
				});
				
			}
			
			//购物车验证
			$(".logonConfirm").click(function(){
				if($("#login_info").html()=="登录"){
					$('#myModal').modal();
				}else{
					var cusCount=$(".badge").text();
					window.localStorage.setItem("cusCount",cusCount);
					location.href("shopping.html");
				}
				return false;
			});
			
		
			
			//加入购物车添加单击事件,判断用户是否登录。如果未登录跳出登陆页面。如果已登录直接加
			function clickShopping(){
				$(":button[name=add_shop_btn]").click(function(){
					if($("#login_info").html()=="登录"){
						//弹出登录框
						$('#myModal').modal();
					}
					else{
						//向服务器传送商品id
						var goodsId=$(this).attr("title");
						$.ajax({
							cache:false,
							type:"post",
							url:"shopping.do",
							data:{"goodsId":goodsId},
							async:true,
							
							error:function(){
								alert("购物车添加失败");
							},
							
							success:function(data){
								$(".badge").text(data);
							}
						
						});
					
					}
				});
			}
			
			
			//检查用户名是否存在
			function checkLogon(customerName){
				if(customerName!=undefined){
					$("#login_info").html(customerName+"已登录");
				} else{
					$("#login_info").html("登录");
				}
			}
			
			function pageClick(){
				
				$("#pages li a").click(function(){
					  //得到正在点击的a标记的hred属性值
					  var currentPage=$(this).attr("href");
					 
					  var goodsName=$("#goods_name_txt").val();
					  loadData(currentPage,goodsName);
					  
					
					return false;
					
				});
				
				
				
			}
			//调用单击查询按钮的函数
			clickGoodsSearch();
			/*给查询按钮加单击事件*/
			function clickGoodsSearch(){
				
				$("#goods_search_btn").click(function(){
					
					var goodsName=$("#goods_name_txt").val();
					
					loadData(1,goodsName);
					
				});
				
				
			}
		</script>
	</body>
</html>
